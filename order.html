<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Complete Your Order – SabkaPremium</title>
  <link rel="icon" type="image/png" href="./assets/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <!-- Meta Pixel Code -->
  <script>
    !function (f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','1281510500113019'); fbq('track','PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1281510500113019&ev=PageView&noscript=1"/></noscript>
  <!-- End Meta Pixel Code -->
</head>

<body class="order-body">
  <main class="order-wrap">
    <section class="order-card">
      <h1>Complete Your Payment</h1>

      <div class="qr">
        <img id="qrImage" src="./assets/upi-qr.png.jpg" alt="UPI QR Code"/>
        <div class="upi-line">
          <span>UPI ID:</span> <code>somyajain2208@okaxis</code>
        </div>
      </div>

      <form id="orderForm" class="form">
        <div class="two">
          <label>
            <span>Your Name</span>
            <input type="text" name="name" required />
          </label>
          <label>
            <span>Your Email</span>
            <input type="email" name="email" required />
          </label>
        </div>

        <label>
          <span>Your Phone</span>
          <input type="tel" name="phone" required />
        </label>

        <div class="two">
          <label>
            <span>Selected Plan</span>
            <input type="text" name="plan" id="planInput" readonly required />
          </label>
          <label>
            <span>Amount</span>
            <input type="text" name="amount" id="amountInput" readonly required />
          </label>
        </div>

        <div class="coupon-row">
          <input type="text" id="couponCode" placeholder="Enter Coupon Code" aria-label="Coupon Code" />
          <button type="button" class="btn-ghost" id="applyCouponBtn">Apply</button>
        </div>
        <p id="discountMessage" class="ok hide">Coupon applied successfully!</p>
        <p id="discountAmount" class="warn hide">Discount: ₹0</p>

        <label>
          <span>Transaction ID / UTR</span>
          <input type="text" name="transactionId" required />
        </label>

        <label class="file">
          <span>Upload Payment Screenshot (optional)</span>
          <input type="file" name="screenshot" accept="image/*" />
        </label>

        <button type="submit" class="btn-primary wfull">Submit Details</button>

        <p class="tiny">Facing issues? Reach us on <a href="https://t.me/Somya2208" target="_blank">Telegram</a> or
          <a href="https://instagram.com/sabka_premium" target="_blank">Instagram</a>.
        </p>
      </form>
    </section>
  </main>

  <script>
    // --- Plan mapping ---
    const planMap = {
      "ChatGPT-1M-599": { name: "ChatGPT - 1 Month", amount: "599" },
      "ChatGPT-3M-399": { name: "ChatGPT - 3 Months", amount: "399" },
      "ChatGPT-6M-599": { name: "ChatGPT - 6 Months", amount: "599" },
      "ChatGPT-12M-1999": { name: "ChatGPT - 12 Months", amount: "1999" },
      "ChatGPT-3M-1499": { name: "ChatGPT Private - 3 Months", amount: "1499" },
      "ChatGPT-6M-899": { name: "ChatGPT - 6 Months (3–4 Members)", amount: "899" },
      "ChatGPT-12M-1399": { name: "ChatGPT - 12 Months (3–4 Members)", amount: "1399" },

      "Netflix-1M-149": { name: "Netflix - 1 Month", amount: "149" },
      "Netflix-3M-399": { name: "Netflix - 3 Months", amount: "399" },
      "Netflix-6M-599": { name: "Netflix - 6 Months", amount: "599" },
      "Netflix-12M-1099": { name: "Netflix - 12 Months", amount: "1099" },

      "Prime-1M-99": { name: "Prime Video - 1 Month", amount: "99" },
      "Prime-3M-199": { name: "Prime Video - 3 Months", amount: "199" },
      "Prime-6M-299": { name: "Prime Video - 6 Months", amount: "299" },
      "Prime-12M-399": { name: "Prime Video - 12 Months", amount: "399" },

      "Canva-12M-399": { name: "Canva Pro - 1 Year", amount: "399" },

      "Gemini-1M-199": { name: "Gemini Pro + 2TB - 1 Month", amount: "199" },
      "Gemini-1Y-999": { name: "Gemini Pro + 2TB - 1 Year", amount: "999" },

      "YouTube-Individual-1M-89": { name: "YouTube Premium Individual - 1 Month", amount: "89" },
      "YouTube-Individual-3M-229": { name: "YouTube Premium Individual - 3 Months", amount: "229" },
      "YouTube-Individual-6M-399": { name: "YouTube Premium Individual - 6 Months", amount: "399" },
      "YouTube-Individual-12M-749": { name: "YouTube Premium Individual - 12 Months", amount: "749" },

      "YouTube-Family-1M-199": { name: "YouTube Premium Family - 1 Month", amount: "199" },
      "YouTube-Family-3M-349": { name: "YouTube Premium Family - 3 Months", amount: "349" },
      "YouTube-Family-6M-649": { name: "YouTube Premium Family - 6 Months", amount: "649" },
      "YouTube-Family-12M-1199": { name: "YouTube Premium Family - 12 Months", amount: "1199" },

      "ChatGLM-3M-999": { name: "ChatGLM Pro Suite – 3 Months", amount: "999" },
      "ElevenLabs-3M-1499": { name: "ElevenLabs – Creator (3 Months)", amount: "1499" }
    };

    // Optional coupons (example structure)
    const validCoupons = {
      // "SAVE50": { discountedPrice: 1499, validFor: ["ChatGPT-3M-1999"] },
    };

    // Read plan from URL and set fields + dynamic QR
    const urlParams = new URLSearchParams(window.location.search);
    const planCode = urlParams.get("plan");

    if (planCode && planMap[planCode]) {
      document.getElementById("planInput").value = planMap[planCode].name;
      document.getElementById("amountInput").value = "₹" + planMap[planCode].amount;

      // Generate QR from UPI deeplink
      const upiId = "somya2208jain2208@okaxis";
      const name = "Soumya Jain";
      const amount = planMap[planCode].amount;
      const data = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}&am=${amount}&cu=INR`;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(data)}`;
      document.getElementById("qrImage").src = qrUrl;
    }

    // Coupon application
    document.getElementById("applyCouponBtn").addEventListener("click", () => {
      const code = document.getElementById("couponCode").value.trim();
      const msg = document.getElementById("discountMessage");
      const disc = document.getElementById("discountAmount");

      if (!validCoupons[code]) { alert("Invalid Coupon Code."); return; }
      const coupon = validCoupons[code];
      if (!coupon.validFor.includes(planCode)) { alert("This coupon is not valid for your selected plan."); return; }

      document.getElementById("amountInput").value = "₹" + coupon.discountedPrice;
      msg.classList.remove("hide");
      disc.classList.add("hide");
    });

    // Submit to Google Apps Script
    const form = document.getElementById("orderForm");
    const submitBtn = form.querySelector("button[type=submit]");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true; submitBtn.textContent = "Submitting...";

      const fd = new FormData(form);
      const file = fd.get("screenshot");
      let base64 = ""; let mime = "";
      if (file && file.size > 0) {
        base64 = await fileToBase64(file);
        base64 = base64.split(",")[1] || ""; // only data part
        mime = file.type;
      }

      const payload = {};
      fd.forEach((v, k) => payload[k] = v);
      payload.screenshotBase64 = base64;
      payload.screenshotType = mime;

      fetch("https://script.google.com/macros/s/AKfycbz4O6KY0iVgy4XtFmg9NI0fLKWmb3iqISkZReo62UltYcYeyBjsOxWYfE4QtHXOKxky6g/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(payload)
      })
      .then(() => { alert("Your details have been submitted! We will verify and deliver shortly."); form.reset(); })
      .catch(err => alert("Error: " + err))
      .finally(() => { submitBtn.disabled = false; submitBtn.textContent = "Submit Details"; });
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (err) => reject(err);
      });
    }
  </script>
</body>
</html>
