<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Complete Your Order</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }

        .container {
            max-width: 450px;
            background: #fff;
            padding: 20px;
            margin: auto;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        input,
        select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 15px;
            background: #fff;
            color: #222;
        }

        input[readonly] {
            background: #f8f8f8;
            color: #444;
            font-weight: bold;
        }

        button {
            padding: 12px;
            background: #10a37f;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background: #0a7d60;
        }

        button:disabled {
            background: #7fbfa9;
            cursor: not-allowed;
        }

        .qr-section {
            text-align: center;
            margin-bottom: 15px;
        }

        .qr-section img {
            max-width: 200px;
        }
    </style>

    <!-- Meta Pixel Code -->
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1281510500113019');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=1281510500113019&ev=PageView&noscript=1" /></noscript>
    <!-- End Meta Pixel Code -->


</head>

<body>
    <div class="container">
        <h2>Complete Your Payment</h2>

        <div class="qr-section">
            <p>Scan this QR to Pay:</p>
            <img src="./assets/upi-qr.png.jpg" alt="UPI QR Code">
            <p><strong>UPI ID:</strong> somyajain2208@okaxis</p>
        </div>

        <form id="orderForm">
            <input type="text" name="name" placeholder="Your Name" required>
            <input type="email" name="email" placeholder="Your Email" required>
            <input type="tel" name="phone" placeholder="Your Phone" required>

            <!-- Auto-filled Plan -->
            <input type="text" name="plan" id="planInput" readonly required>
            <input type="text" name="amount" id="amountInput" readonly required>

            <!-- Coupon Code Section -->
            <input type="text" id="couponCode" placeholder="Enter Coupon Code">
            <button type="button" id="applyCouponBtn">Apply Coupon</button>

            <p id="discountMessage" style="color: green; display: none;">Coupon applied successfully!</p>
            <p id="discountAmount" style="color: red; display: none;">Discount: ₹0</p>

            <input type="text" name="transactionId" placeholder="Transaction ID / UTR" required>
            <input type="file" name="screenshot" accept="image/*">
            <button type="submit">Submit Details</button>
        </form>


        <div class="support-info" style="margin-top:15px; text-align:center; font-size:14px; color:#444;">
            <p>If you face any issue, you can reach us:</p>
            <p>
                <a href="https://t.me/Somya2208" target="_blank">
                    <i class="fab fa-telegram-plane"></i> Telegram
                </a> |
                <a href="https://instagram.com/sabka_premium" target="_blank">
                    <i class="fab fa-instagram"></i> Instagram
                </a> |
                <a href="mailto:sabkapremium01@gmail.com">
                    <i class="fas fa-envelope"></i> Email
                </a>
            </p>
        </div>

    </div>

    <script>
        // Plan Mapping (plan codes → display name and amount)
        const planMap = {
            "ChatGPT-1M-599": { name: "ChatGPT - 1 Month", amount: "599" },
            "ChatGPT-3M-1699": { name: "ChatGPT - 3 Month", amount: "1699" },
            "ChatGPT-3M-399": { name: "ChatGPT - 3 Month", amount: "399" },
            "ChatGPT-6M-599": { name: "ChatGPT - 6 Month", amount: "599" },
            "ChatGPT-12M-999": { name: "ChatGPT - 12 Month", amount: "999" },
            "ChatGPT-3M-1499": { name: "ChatGPT - 3 Month", amount: "1499" },
            "ChatGPT-6M-899": { name: "ChatGPT - 6 Month", amount: "899" },
            "ChatGPT-12M-1399": { name: "ChatGPT - 12 Month", amount: "1399" },
            "Netflix-1M-149": { name: "Netflix - 1 Month", amount: "149" },
            "Netflix-3M-399": { name: "Netflix - 3 Months", amount: "399" },
            "Netflix-6M-599": { name: "Netflix - 6 Months", amount: "599" },
            "Netflix-12M-1099": { name: "Netflix - 12 Months", amount: "1099" },
            "Prime-1M-99": { name: "Prime - 1 Month", amount: "99" },
            "Prime-3M-199": { name: "Prime - 3 Month", amount: "199" },
            "Prime-6M-299": { name: "Prime - 6 Month", amount: "299" },
            "Prime-12M-399": { name: "Prime - 12 Month", amount: "399" },
            "Canva-12M-399": { name: "Canva Pro - 1 Year", amount: "399" },
            "Gemini-1M-199": { name: "Gemini Pro + 2TB Storage - 1 Months", amount: "199" },
            "Gemini-1Y-999": { name: "Gemini Pro + 2TB Storage - 12 Months", amount: "999" },
            "YouTube-Individual-1M-89": {
                name: "YouTube Premium Individual - 1 Month",
                amount: "89"
            },
            "YouTube-Individual-3M-229": {
                name: "YouTube Premium Individual - 3 Months",
                amount: "229"
            },
            "YouTube-Individual-6M-399": {
                name: "YouTube Premium Individual - 6 Months",
                amount: "399"
            },
            "YouTube-Individual-12M-749": {
                name: "YouTube Premium Individual - 12 Months",
                amount: "749"
            },

            "YouTube-Family-1M-199": {
                name: "YouTube Premium Family - 1 Month",
                amount: "199"
            },
            "YouTube-Family-3M-349": {
                name: "YouTube Premium Family - 3 Months",
                amount: "349"
            },
            "YouTube-Family-6M-649": {
                name: "YouTube Premium Family - 6 Months",
                amount: "649"
            },
            "YouTube-Family-12M-1199": {
                name: "YouTube Premium Family - 12 Months",
                amount: "1199"
            },

            "Combo-1499": { name: "Combo 1 Year", amount: "1499" },

            "ElevenLabs-3M-1499": {
                name: "ElevenLabs - Creator Plan (3 Months)",
                amount: "1499"
            },

        };


        // Coupon code logic
        const validCoupons = {
            "BringsUsmile50": { discountedPrice: 1499, validFor: ["ChatGPT-3M-1999"] },  // Direct price change for ChatGPT 3M Personal plan
        };

        // Apply Coupon Button
        document.getElementById("applyCouponBtn").addEventListener("click", () => {
            const couponCode = document.getElementById("couponCode").value;
            const planCode = new URLSearchParams(window.location.search).get("plan");

            if (validCoupons[couponCode]) {
                const coupon = validCoupons[couponCode];

                if (coupon.validFor.includes(planCode)) {
                    // Apply the direct discounted price
                    const newAmount = coupon.discountedPrice;

                    // Update the amount input
                    document.getElementById("amountInput").value = "₹" + newAmount;

                    // Show the discount message
                    document.getElementById("discountMessage").style.display = "block";
                    document.getElementById("discountAmount").style.display = "none";  // Hide the discount text
                } else {
                    alert("This coupon is not valid for your selected plan.");
                }
            } else {
                alert("Invalid Coupon Code.");
            }
        });




        // Get plan from URL and auto-fill inputs
        const urlParams = new URLSearchParams(window.location.search);
        const planCode = urlParams.get("plan");

        if (planCode && planMap[planCode]) {
            document.getElementById("planInput").value = planMap[planCode].name;
            document.getElementById("amountInput").value = "₹" + planMap[planCode].amount;

            // QR Image generate karega
            const amount = planMap[planCode].amount;
            const upiId = "somya2208jain2208@okaxis";   // apna UPI ID
            const name = "Soumya Jain";                 // apna naam

            document.getElementById("qrImage").src =
                `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}&am=${amount}&cu=INR`;
        }

        // Submit to Google Script
        const form = document.getElementById("orderForm");
        const submitBtn = form.querySelector("button");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Disable button & show loading text
            submitBtn.disabled = true;
            submitBtn.textContent = "Submitting... ⏳";

            const formData = new FormData(form);

            // File ko Base64 me convert
            const screenshotFile = formData.get("screenshot");
            let base64String = "";
            if (screenshotFile && screenshotFile.size > 0) {
                base64String = await toBase64(screenshotFile);
            }

            // JSON object create
            const payload = {};
            formData.forEach((value, key) => payload[key] = value);
            payload.screenshotBase64 = base64String.split(",")[1] || ""; // Base64 data only
            payload.screenshotType = screenshotFile ? screenshotFile.type : "";

            // Send JSON
            fetch("https://script.google.com/macros/s/AKfycbz4O6KY0iVgy4XtFmg9NI0fLKWmb3iqISkZReo62UltYcYeyBjsOxWYfE4QtHXOKxky6g/exec", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams(payload)
            })
                .then(() => {
                    alert("Your details have been submitted! We will verify and deliver shortly.");
                    form.reset();
                })
                .catch(err => alert("Error: " + err))
                .finally(() => {
                    // Enable button & reset text
                    submitBtn.disabled = false;
                    submitBtn.textContent = "Submit Details";
                });
        });

        // Helper: File to Base64
        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
            });
        }

    </script>
</body>

</html>